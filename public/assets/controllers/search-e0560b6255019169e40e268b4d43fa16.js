function runSearch(t){var e,n,r,i={};e=void 0==t.fields?getParam("fields"):t.fields,n=void 0==t.query?getParam("query"):t.query,i.query=n,i.fields=e,i.format="json",$.each(t,function(t,e){"fields"!=t&&"query"!=t&&"scroll"!=t&&(i[t+"_page"]=e,r=t)}),$.get("/search/",i,function(e){var n=0,i=[];$(".search-selector li").each(function(){i.push($(this).text().toLowerCase())}),$content.fadeOut(250,function(){if(void 0==r){$(this).html("");for(var a=0;a<i.length;a++)void 0!=e[i[a]]&&$content.append(formatItem(i[a],e[i[a]],!1))}else $content.append(formatItem(r,e[r],!0));n=$(".search-item").length,$(".search-count").text(function(){return 0==n?"No results for...":1==n?"1 result for...":n+" results for..."}),0==n&&$content.html($("<p>").attr("class","text-center").text("Sorry, we didn't find anything! Try searching more entities.")),$(this).fadeIn(250,function(){if(void 0==r||""==r){var e=$("div[data-searchtype="+t.scroll+"]").offset();void 0!=e&&void 0!=t.scroll?scrollToPos(e.top-90):scrollToPos(0)}})})})}function getSelected(){var t=[];return $(".search-selector li").each(function(){$(this).hasClass("active")&&t.push($(this).text().toLowerCase())}),t}function getParam(t,e){void 0==e&&(e=location.search),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=n.exec(e);return null==r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function formatItem(t,e,n){if(0==e.data.length)return!1;var r;return 0==n?(r=$("<div>").attr("class","search-type-container").attr("data-searchtype",t),r.append($("<h3>").text(t.charAt(0).toUpperCase()+t.slice(1)))):r=$("div[data-searchtype="+t+"]"),r.find(".pagination-centered").remove(),"users"==t||("bills"==t?$.each(e.data,function(){var t=this;r.append($("<div>").attr("class","search-item").append($("<h4>").append($("<a>").attr("href","/congress/bills/"+this.billId).text(function(){return null!=t.popularTitle?t.popularTitle:null!=t.shortTitle?t.shortTitle:t.officialTitle}))).append($("<p>").text(trimByWord(t.summary,30)).append($("<a>").attr("href","/congress/bills/"+this.billId).text("Explore »"))))}):"industries"==t&&$.each(e.data,function(){r.append($("<div>").attr("class","search-item").append($("<h4>").append($("<a>").attr("href","/industries/"+this.name.toLowerCase().replace(/\W/g," ").replace(/\s{2,}/g," ").split(" ").join("-")+"/"+this.industry_id).text(this.name))).append($("<p>").html("<b>Industry: </b>"+this.industry+"<br><b>Sector: </b>"+this.sector_long+"<br>").append($("<a>").attr("href","/industries/"+this.name.toLowerCase().replace(/\W/g," ").replace(/\s{2,}/g," ").split(" ").join("-")+"/"+this.industry_id).text("Explore »"))))})),void 0!=e.paging.next&&r.append($("<div>").attr("class","pagination-centered").append($("<ul>").attr("class","pagination").append($("<li>").attr("class","current").append($("<a>").attr("href","#").attr("data-page",e.paging.next-1).text(e.paging.next-1))).append($("<li>").attr("class","arrow").append($("<a>").attr("href","#").attr("data-page",e.paging.next).text("More results »"))))),r}var $content=$(".search-area");getParam("fields")&&getParam("query")&&runSearch({fields:getSelected().join(),query:$(".search-input").val()}),$(".search-selector a").on("click",function(t){t.preventDefault(),$(this).parent().toggleClass("active");var e=getSelected().join(),n=getParam("fields",t.target.href);history.pushState("","",t.target.href.replace("fields="+n,"fields="+e)),$(this).parent().hasClass("active")?runSearch({fields:e,query:$(".search-input").val(),scroll:$(this).text().toLowerCase()}):runSearch({fields:e,query:$(".search-input").val()})}),$(".search-input, .menu-search").on("keyup",function(){$(this).hasClass("search-input")?$(".menu-search").val($(this).val()):$(".search-input").val($(this).val())}).on("keypress",function(t){if(13==t.which){t.preventDefault();var e=getParam("query",location.search).split(" ").join("%20");history.pushState("","",location.search.replace("query="+e,"query="+$(this).val())),runSearch({fields:getSelected().join(),query:$(this).val()})}}),$(".menu-search-click").on("click",function(t){t.preventDefault(),runSearch({fields:getSelected().join(),query:$(this).prev().val()})}),$(document).on("click",".search-type-container .pagination a",function(t){t.preventDefault();var e=$(this).attr("data-page"),n=$(this).parents(".search-type-container").attr("data-searchtype"),r={};r.fields=getSelected().join(),r.query=$(".search-input").val(),r.scroll=n,r[n]=e,runSearch(r)});