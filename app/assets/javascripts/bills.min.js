/* ----- VOTE BREAKDOWN ----- */function voteBreakdown(e){function g(e){$("#voteBD .legend li").each(function(){$(this).attr("data-depth")!=e?$(this).hide().removeClass("currentDepth"):$(this).fadeIn(250).addClass("currentDepth")});e==1?voteBD.svg.datum(t).selectAll("path").data(voteBD.partition.nodes).transition().duration(250).attr("d",voteBD.arc):voteBD.svg.datum(t).selectAll("path").data(voteBD.partition.nodes).transition().duration(250).attr("d",voteBD.arc2)}function y(){return parseInt($("#voteBD .legend li.currentDepth").attr("data-depth"))}function b(e){$("#voteBD .voteBD-center li").removeClass("currentCenter").hide();$("#voteBD .voteBD-center li:eq("+e+")").addClass("currentCenter").fadeIn(250)}function w(){return parseInt($("#voteBD .voteBD-center li.currentCenter").index())}function E(e){e==1?$vote.find(".d3Tooltip").html("").removeClass("taller").append($("<ul>").attr("class","tooltipSplit").append($("<li>").append($("<span>").attr("class","title").text(i)).append($("<span>").attr("class","amount").text(o+"%")).append($("<span>").attr("class","subAmount").text(a+" votes"))).append($("<li>").append($("<span>").attr("class","title").text(s)).append($("<span>").attr("class","amount").text(u+"%")).append($("<span>").attr("class","subAmount").text(f+" votes")))):$vote.find(".d3Tooltip").html("").addClass("taller").append($("<ul>").attr("class","tooltipSplit").append($("<li>").append($("<span>").attr("class","title").text(i)).append($("<ul>").attr("class","legend").append($("<li>").append($("<span>").attr("class","square").css("background",voteBD.color(2))).append($("<span>").attr("class","title").text(l+"%"))).append($("<li>").append($("<span>").attr("class","square").css("background",voteBD.color(3))).append($("<span>").attr("class","title").text(c+"%"))).append($("<li>").append($("<span>").attr("class","square").css("background",voteBD.color(4))).append($("<span>").attr("class","title").text(h+"%"))))).append($("<li>").append($("<span>").attr("class","title").text(s)).append($("<ul>").attr("class","legend").append($("<li>").append($("<span>").attr("class","square").css("background",voteBD.color(2))).append($("<span>").attr("class","title").text(p+"%"))).append($("<li>").append($("<span>").attr("class","square").css("background",voteBD.color(3))).append($("<span>").attr("class","title").text(d+"%"))).append($("<li>").append($("<span>").attr("class","square").css("background",voteBD.color(4))).append($("<span>").attr("class","title").text(v+"%"))))))}function S(e){e.x0=e.x;e.dx0=e.dx}function x(e){var t=d3.interpolate({x:e.x0,dx:e.dx0},e);return function(n){var r=t(n);e.x0=r.x;e.dx0=r.dx;return arc(r)}}var t=JSON.parse(JSON.stringify(e)),n=t.children[0].children[0].size+t.children[0].children[1].size+t.children[0].children[2].size,r=t.children[1].children[0].size+t.children[1].children[1].size+t.children[1].children[2].size;if(n>r)var i="yeas",s="nays",o=parseInt(n/(n+r)*100),u=100-o,a=n,f=r,l=parseInt(t.children[0].children[0].size/n*100),c=parseInt(t.children[0].children[1].size/n*100),h=parseInt(t.children[0].children[2].size/n*100),p=parseInt(t.children[1].children[0].size/r*100),d=parseInt(t.children[1].children[1].size/r*100),v=parseInt(t.children[1].children[2].size/r*100);else if(n<r)var i="nays",s="yeas",o=parseInt(r/(n+r)*100),u=100-o,a=r,f=n,l=parseInt(t.children[1].children[0].size/r*100),c=parseInt(t.children[1].children[1].size/r*100),h=parseInt(t.children[1].children[2].size/r*100),p=parseInt(t.children[0].children[0].size/n*100),d=parseInt(t.children[0].children[1].size/n*100),v=parseInt(t.children[0].children[2].size/n*100);else var i="draw",s="draw",o,a=50,u,f=50,l=parseInt(t.children[0].children[0].size/n*100),c=parseInt(t.children[0].children[1].size/n*100),h=parseInt(t.children[0].children[2].size/n*100),p=parseInt(t.children[1].children[0].size/r*100),d=parseInt(t.children[1].children[1].size/r*100),v=parseInt(t.children[1].children[2].size/r*100);$vote.find("h4").after($("<ul>").attr("class","legend top").append($("<li>").attr("data-depth",1).append($("<span>").attr("class","square").css("background",voteBD.color(0))).append($("<span>").attr("class","title").text(i))).append($("<li>").attr("data-depth",1).append($("<span>").attr("class","square").css("background",voteBD.color(1))).append($("<span>").attr("class","title").text(s))).append($("<li>").attr("data-depth",2).append($("<span>").attr("class","square").css("background",voteBD.color(2))).append($("<span>").attr("class","title").text("Democrat"))).append($("<li>").attr("data-depth",2).append($("<span>").attr("class","square").css("background",voteBD.color(3))).append($("<span>").attr("class","title").text("Republican"))).append($("<li>").attr("data-depth",2).append($("<span>").attr("class","square").css("background",voteBD.color(4))).append($("<span>").attr("class","title").text("Independent"))));$vote.find(".legend").after($("<ul>").attr("class","voteBD-center interactive").append($("<li>").append($("<span>").attr("class","title").text(i)).append($("<span>").attr("class","amount").text(o+"%"))).append($("<li>").append($("<span>").attr("class","title").text(s)).append($("<span>").attr("class","amount").text(u+"%"))));$vote.find("svg").before($("<div>").attr("class","d3Tooltip"));var m=voteBD.svg.datum(t).selectAll("path").data(voteBD.partition.nodes).enter().append("path").attr("d",voteBD.arc).attr("class","interactive").attr("data-depth",function(e){return e.depth}).style("fill",function(e){return e.depth==0?"#fafafa":e.depth==1?e.name==i?voteBD.color(0):voteBD.color(1):e.name=="D"?voteBD.color(2):e.name=="R"?voteBD.color(3):voteBD.color(4)}).each(S);$vote.fadeIn(500);g(1);b(0);centerVBDCenter();setVBDHeight();$vote.find("path").on("click",function(){if($(this).attr("data-depth")==0)w()==1?b(0):b(1);else if(y()==1){g(2);E(2)}else{g(1);E(1)}}).on("mouseover",function(){$(this).attr("data-depth")!=0&&$vote.find(".d3Tooltip").show()}).on("mouseout",function(){$vote.find(".d3Tooltip").hide()}).on("mousemove",throttle(function(e){E(y());var t=e.pageX-$vote.offset().left,n=e.pageY-$vote.offset().top;$vote.find(".d3Tooltip").css("left",t+10).css("top",n+10)},10));$vote.find(".voteBD-center").on("click",function(){$vote.find("path:first-of-type").trigger("click")})}function centerVBDCenter(){var e=$vote.find("svg g:first-of-type"),t=e[0].getBoundingClientRect().height,n=e[0].getBoundingClientRect().width,r=$vote.find(".voteBD-center"),i=r.height(),s=r.width();r.css("margin-top",t/2-i/2-12).css("margin-left",n/2-s/2-3)}function setVBDHeight(){var e=$vote.find("svg"),t=e.width();e.height(t+20)}$.get("assets/bill_test.json",function(e){$.each(e.votes.yeas,function(e,t){if(this.party=="D"){voteBD_JSON[this.state].children[0].children[0].size++;voteBD_JSON.total.children[0].children[0].size++}else if(this.party=="R"){voteBD_JSON[this.state].children[0].children[1].size++;voteBD_JSON.total.children[0].children[1].size++}else{voteBD_JSON[this.state].children[0].children[2].size++;voteBD_JSON.total.children[0].children[2].size++}});$.each(e.votes.nays,function(e,t){if(this.party=="D"){voteBD_JSON[this.state].children[1].children[0].size++;voteBD_JSON.total.children[1].children[0].size++}else if(this.party=="R"){voteBD_JSON[this.state].children[1].children[1].size++;voteBD_JSON.total.children[1].children[1].size++}else{voteBD_JSON[this.state].children[1].children[2].size++;voteBD_JSON.total.children[1].children[2].size++}});$("#voteBD").hide();voteBreakdown(voteBD_JSON.total)});var voteBD_JSON={total:{name:"total",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},AL:{name:"AL",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},AK:{name:"AK",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},AZ:{name:"AZ",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},AR:{name:"AR",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},CA:{name:"CA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},CO:{name:"CO",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},CT:{name:"CT",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},DE:{name:"DE",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},FL:{name:"FL",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},GA:{name:"GA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},HI:{name:"HI",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},ID:{name:"ID",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},IL:{name:"IL",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},IN:{name:"IN",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},IA:{name:"IA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},KS:{name:"KS",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},KY:{name:"KY",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},LA:{name:"LA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},ME:{name:"ME",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MD:{name:"MD",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MA:{name:"MA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MI:{name:"MI",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MN:{name:"MN",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MS:{name:"MS",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MO:{name:"MO",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MT:{name:"MT",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NE:{name:"NE",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NV:{name:"NV",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NH:{name:"NH",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NJ:{name:"NJ",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NM:{name:"NM",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NY:{name:"NY",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NC:{name:"NC",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},ND:{name:"ND",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},OH:{name:"OH",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},OK:{name:"OK",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},OR:{name:"OR",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},PA:{name:"PA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},RI:{name:"RI",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},SC:{name:"SC",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},SD:{name:"SD",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},TN:{name:"TN",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},TX:{name:"TX",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},UT:{name:"UT",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},VT:{name:"VT",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},VA:{name:"VA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},WA:{name:"WA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},WV:{name:"WV",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},WI:{name:"WI",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},WY:{name:"WY",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]}};$("#graphs").append($("<div>").attr("class","large-4 small-10 large-uncentered small-centered columns graph").attr("id","voteBD").append($("<h4>").text("Vote Breakdown")).append($("<div>").attr("class","sharable").append($("<span>").attr("aria-hidden",!0).attr("class","icon-earth")).append($("<span>").text("Share"))));var voteBD={};voteBD.width=300;voteBD.height=300;voteBD.radius=Math.min(voteBD.width,voteBD.height)/2;voteBD.color=d3.scale.ordinal().range(["#C4D117","#DDDDDD","#61D2D6","#EA3556","#888888"]).domain(d3.range(0,5));voteBD.svg=d3.select("#voteBD").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(voteBD.width,voteBD.height)+" "+Math.min(voteBD.width,voteBD.height)).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate("+voteBD.width/2+","+voteBD.height/2+") rotate(90)");voteBD.partition=d3.layout.partition().sort(null).size([2*Math.PI,voteBD.radius*voteBD.radius]).value(function(e){return e.size});voteBD.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return e.depth!=2?Math.sqrt(e.y):Math.sqrt(e.y)+22}).outerRadius(function(e){return e.depth!=2?Math.sqrt(e.y+e.dy)+22:Math.sqrt(e.y+e.dy)});voteBD.arc2=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)});var $vote=$("#voteBD");$(window).on("resize",function(){centerVBDCenter();setVBDHeight()});