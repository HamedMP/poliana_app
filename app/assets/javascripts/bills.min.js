/*
----- VOTE BREAKDOWN -----
Author: Patrick Cason
Notes: The most common sense way to order this data would perhaps be using politicians as the inner most children. D3 partitions create every DOM element in a structure and then (in this case) hide the center element. However, keeping a data structure of individual votes may not be the best of ideas because in the House, there would be 535 DOM elements created that would always be hidden. For performance reasons, we'll restructure the JSON strcture for this graph to to be as such:

votes
  - total
	- yea
	  - dem: value
	  - rep: value
	  - indep: value
	- nay
	  - dem: value
	  - rep: value
	  - indep: value
  - alabama
	- yea
	  - dem: value
	  - rep: value
	  - indep: value
	- nay
	  - dem: value
	  - rep: value
	  - indep: value
  - ...
*/function voteBreakdown(e){function l(e){$("#voteBD .legend li").each(function(){$(this).attr("data-depth")!=e?$(this).hide().removeClass("currentDepth"):$(this).show().addClass("currentDepth")});e==1?f.attr("d",voteBD.arc):f.attr("d",voteBD.arc2)}function c(){return parseInt($("#voteBD .legend li.currentDepth").attr("data-depth"))}function h(e){$("#voteBD .voteBD-center li").removeClass("currentCenter").hide();$("#voteBD .voteBD-center li:eq("+e+")").addClass("currentCenter").show()}function p(){return parseInt($("#voteBD .voteBD-center li.currentCenter").index())}function d(e){e.x0=e.x;e.dx0=e.dx}function v(e){var t=d3.interpolate({x:e.x0,dx:e.dx0},e);return function(n){var r=t(n);e.x0=r.x;e.dx0=r.dx;return voteBD.arc(r)}}var t=JSON.parse(JSON.stringify(e)),n="",r=t.children[0].children[0].size+t.children[0].children[1].size+t.children[0].children[2].size,i=t.children[1].children[0].size+t.children[1].children[1].size+t.children[1].children[2].size;if(r>i)var s="yeas",o="nays",u=parseInt(r/(r+i)*100),a=100-u;else if(r<i)var s="nays",o="yeas",u=parseInt(i/(r+i)*100),a=100-u;else var s="draw",o="draw",u=50,a=50;$vote.find("h4").after($("<ul>").attr("class","legend").append($("<li>").attr("data-depth",1).append($("<span>").attr("class","square").css("background",voteBD.color(0))).append($("<span>").attr("class","title").text(s))).append($("<li>").attr("data-depth",1).append($("<span>").attr("class","square").css("background",voteBD.color(1))).append($("<span>").attr("class","title").text(o))).append($("<li>").attr("data-depth",2).append($("<span>").attr("class","square").css("background",voteBD.color(2))).append($("<span>").attr("class","title").text("Democrat"))).append($("<li>").attr("data-depth",2).append($("<span>").attr("class","square").css("background",voteBD.color(3))).append($("<span>").attr("class","title").text("Republican"))).append($("<li>").attr("data-depth",2).append($("<span>").attr("class","square").css("background",voteBD.color(4))).append($("<span>").attr("class","title").text("Independent"))));$vote.find(".legend").after($("<ul>").attr("class","voteBD-center").append($("<li>").append($("<span>").attr("class","title").text(s)).append($("<span>").attr("class","amount").text(u+"%"))).append($("<li>").append($("<span>").attr("class","title").text(o)).append($("<span>").attr("class","amount").text(a+"%"))));var f=voteBD.svg.datum(t).selectAll("path").data(voteBD.partition.nodes).enter().append("path").attr("d",voteBD.arc).attr("data-depth",function(e){return e.depth}).style("fill",function(e){return e.depth==0?"#fafafa":e.depth==1?e.name==s?voteBD.color(0):voteBD.color(1):e.name=="D"?voteBD.color(2):e.name=="R"?voteBD.color(3):voteBD.color(4)}).each(d);$vote.fadeIn(500);l(1);h(0);centerCenter();$vote.find("path").on("click",function(){$(this).attr("data-depth")==0?p()==1?h(0):h(1):c()==1?l(2):l(1)});$vote.find(".voteBD-center").on("click",function(){$vote.find("path:first-of-type").trigger("click")});d3.select(self.frameElement).style("height",voteBD.height+"px")}function centerCenter(){var e=$vote.find("svg g:first-of-type"),t=e[0].getBoundingClientRect().height,n=e[0].getBoundingClientRect().width,r=$vote.find(".voteBD-center"),i=r.height(),s=r.width();r.css("margin-top",t/2-i/2-12).css("margin-left",n/2-s/2-3)}$.get("assets/bill_test.json",function(e){$.each(e.votes.yeas,function(e,t){if(this.party=="D"){voteBD_JSON[this.state].children[0].children[0].size++;voteBD_JSON.total.children[0].children[0].size++}else if(this.party=="R"){voteBD_JSON[this.state].children[0].children[1].size++;voteBD_JSON.total.children[0].children[1].size++}else{voteBD_JSON[this.state].children[0].children[2].size++;voteBD_JSON.total.children[0].children[2].size++}});$.each(e.votes.nays,function(e,t){if(this.party=="D"){voteBD_JSON[this.state].children[1].children[0].size++;voteBD_JSON.total.children[1].children[0].size++}else if(this.party=="R"){voteBD_JSON[this.state].children[1].children[1].size++;voteBD_JSON.total.children[1].children[1].size++}else{voteBD_JSON[this.state].children[1].children[2].size++;voteBD_JSON.total.children[1].children[2].size++}});$("#voteBD").hide();voteBreakdown(voteBD_JSON.total)});var voteBD_JSON={total:{name:"total",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},AL:{name:"AL",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},AK:{name:"AK",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},AZ:{name:"AZ",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},AR:{name:"AR",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},CA:{name:"CA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},CO:{name:"CO",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},CT:{name:"CT",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},DE:{name:"DE",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},FL:{name:"FL",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},GA:{name:"GA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},HI:{name:"HI",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},ID:{name:"ID",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},IL:{name:"IL",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},IN:{name:"IN",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},IA:{name:"IA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},KS:{name:"KS",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},KY:{name:"KY",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},LA:{name:"LA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},ME:{name:"ME",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MD:{name:"MD",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MA:{name:"MA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MI:{name:"MI",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MN:{name:"MN",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MS:{name:"MS",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MO:{name:"MO",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},MT:{name:"MT",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NE:{name:"NE",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NV:{name:"NV",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NH:{name:"NH",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NJ:{name:"NJ",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NM:{name:"NM",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NY:{name:"NY",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},NC:{name:"NC",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},ND:{name:"ND",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},OH:{name:"OH",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},OK:{name:"OK",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},OR:{name:"OR",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},PA:{name:"PA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},RI:{name:"RI",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},SC:{name:"SC",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},SD:{name:"SD",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},TN:{name:"TN",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},TX:{name:"TX",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},UT:{name:"UT",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},VT:{name:"VT",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},VA:{name:"VA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},WA:{name:"WA",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},WV:{name:"WV",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},WI:{name:"WI",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]},WY:{name:"WY",children:[{name:"yeas",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},{name:"nays",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]}]}},voteBD={};voteBD.width=300;voteBD.height=300;voteBD.radius=Math.min(voteBD.width,voteBD.height)/2;voteBD.color=d3.scale.ordinal().range(["#C4D117","#DDDDDD","#61D2D6","#EA3556","#888888"]).domain(d3.range(0,5));$("#graphs").append($("<div>").attr("class","large-4 small-10 large-uncentered small-centered columns graph").attr("id","voteBD").append($("<h4>").text("Vote Breakdown")));voteBD.svg=d3.select("#voteBD").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(voteBD.width,voteBD.height)+" "+Math.min(voteBD.width,voteBD.height)).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate("+voteBD.width/2+","+voteBD.height/2+") rotate(90)");voteBD.partition=d3.layout.partition().sort(null).size([2*Math.PI,voteBD.radius*voteBD.radius]).value(function(e){return e.size});voteBD.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return e.depth!=2?Math.sqrt(e.y):Math.sqrt(e.y)+20}).outerRadius(function(e){return e.depth!=2?Math.sqrt(e.y+e.dy)+20:Math.sqrt(e.y+e.dy)});voteBD.arc2=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)});var $vote=$("#voteBD");$(window).on("resize",function(){centerCenter()});