function runSearch(e,t,n){e==undefined&&(e=getParam("fields"));t==undefined&&(t=getParam("query"));$.get("/search/",{query:t,page:getParam("page"),fields:e,format:"json"},function(e){var t=0,r=[],i=$(".searchArea");$(".searchSelector li").each(function(e,t){r.push($(this).text().toLowerCase())});i.fadeOut(250,function(){$(this).html("");for(var s=0;s<r.length;s++)if(e[r[s]]!=undefined){i.append(formatItem(r[s],e[r[s]]));t+=e[r[s]].data.length}$(".searchCount").text(function(){return t==0?"No results for...":t==1?"1 result for...":t+" results for..."});t==0&&i.html($("<p>").attr("class","aligncenter").text("Sorry, we didn't find anything! Try searching more entities."));$(this).fadeIn(250,function(){var e=$("div[data-searchType="+n+"]").offset();e!=undefined&&n!=undefined&&$("html, body").animate({scrollTop:e.top-90},500)})})})}function getSelected(){var e=[];$(".searchSelector li").each(function(){$(this).hasClass("active")&&e.push($(this).text().toLowerCase())});return e}function getParam(e,t){t==undefined&&(t=location.search);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=n.exec(t);return r==null?"":decodeURIComponent(r[1].replace(/\+/g," "))}function formatItem(e,t){if(t.data.length==0)return!1;var n=$("<div>").attr("data-searchType",e);n.append($("<h3>").text(e.charAt(0).toUpperCase()+e.slice(1)));e!="users"&&(e=="bills"?$.each(t.data,function(e,t){var r=this;n.append($("<div>").attr("class","searchItem").append($("<h4>").append($("<a>").attr("href","/bills/"+this._id).text(function(){return r.popularTitle!=null?r.popularTitle:r.shortTitle!=null?r.shortTitle:r.officialTitle}))).append($("<p>").text(trimByWord(r.summary)).append($("<a>").attr("href","/bills/"+this._id).text("Explore »"))))}):e!="industries"&&e!="politicians"&&e!="pacs"&&e!="lobbyists"&&e=="organizations");console.log(t);var r=0;for(var i in t.paging)t.paging.hasOwnProperty(i)&&r++;console.log(r);if(r!=0){n.append($("<div>").attr("class","pagination-centered").append($("<ul>").attr("class","pagination").append(function(){if(t.paging.previous!=undefined)return $("<li>").attr("class","arrow").append($("<a>").attr("href","#").text("« Previous"))}).append(function(){if(t.paging.previous!=undefined&&t.paging.next!=undefined)return $("<li>").attr("class","current").append($("<a>").attr("href","#").text(t.paging.next-1));if(t.paging.previous==undefined&&t.paging.next!=undefined)return $("<li>").attr("class","current").append($("<a>").attr("href","#").text(t.paging.next-1));if(t.paging.next==undefined&&t.paging.previous!=undefined)return $("<li>").attr("class","current").append($("<a>").attr("href","#").text(t.paging.previous+1))}).append(function(){if(t.paging.next!=undefined)return $("<li>").attr("class","arrow").append($("<a>").attr("href","#").text("Next »"))})));console.log(t.paging)}return n}function trimByWord(e){var t=e,n=t.split(" ");if(n.length>30){n=n.slice(0,30);t=n.join(" ")+"..."}return t}runSearch();$(".searchSelector a").on("click",function(e){e.preventDefault();$(this).parent().toggleClass("active");var t=getSelected().join(),n=getParam("fields",e.target.href);history.pushState("","",e.target.href.replace("fields="+n,"fields="+t));$(this).parent().hasClass("active")?runSearch(t,$(".searchInput").val(),$(this).text().toLowerCase()):runSearch(t,$(".searchInput").val())});$(".searchInput, .menuSearch").on("keyup",function(){$(this).hasClass("searchInput")?$(".menuSearch").val($(this).val()):$(".searchInput").val($(this).val())}).on("keypress",function(e){if(e.which==13){e.preventDefault();var t=getParam("query",location.search).split(" ").join("%20");history.pushState("","",location.search.replace("query="+t,"query="+$(this).val()));runSearch(getSelected().join(),$(this).val())}});$(".menuSearchClick").on("click",function(e){e.preventDefault();runSearch(getSelected().join(),$(this).prev().val())});