function runSearch(e){var t,n,r,i={};e.fields==undefined?t=getParam("fields"):t=e.fields;e.query==undefined?n=getParam("query"):n=e.query;i.query=n;i.fields=t;i.format="json";$.each(e,function(e,t){if(e!="fields"&&e!="query"&&e!="scroll"){i[e+"_page"]=t;r=e}});$.get("/search/",i,function(t){var n=0,i=[];$(".searchSelector li").each(function(e,t){i.push($(this).text().toLowerCase())});$content.fadeOut(250,function(){if(r==undefined){$(this).html("");for(var s=0;s<i.length;s++)t[i[s]]!=undefined&&$content.append(formatItem(i[s],t[i[s]],!1))}else $content.append(formatItem(r,t[r],!0));n=$(".searchItem").length;$(".searchCount").text(function(){return n==0?"No results for...":n==1?"1 result for...":n+" results for..."});n==0&&$content.html($("<p>").attr("class","aligncenter").text("Sorry, we didn't find anything! Try searching more entities."));$(this).fadeIn(250,function(){if(r==undefined||r==""){var t=$("div[data-searchtype="+e.scroll+"]").offset();t!=undefined&&e.scroll!=undefined?scrollToPos(t.top-90):scrollToPos(0)}})})})}function getSelected(){var e=[];$(".searchSelector li").each(function(){$(this).hasClass("active")&&e.push($(this).text().toLowerCase())});return e}function getParam(e,t){t==undefined&&(t=location.search);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=n.exec(t);return r==null?"":decodeURIComponent(r[1].replace(/\+/g," "))}function formatItem(e,t,n){if(t.data.length==0)return!1;var r;if(n==0){r=$("<div>").attr("class","searchTypeContainer").attr("data-searchtype",e);r.append($("<h3>").text(e.charAt(0).toUpperCase()+e.slice(1)))}else r=$("div[data-searchtype="+e+"]");r.find(".pagination-centered").remove();e!="users"&&(e=="bills"?$.each(t.data,function(e,t){var n=this;r.append($("<div>").attr("class","searchItem").append($("<h4>").append($("<a>").attr("href","/congress/bills/"+this.billId).text(function(){return n.popularTitle!=null?n.popularTitle:n.shortTitle!=null?n.shortTitle:n.officialTitle}))).append($("<p>").text(trimByWord(n.summary,30)).append($("<a>").attr("href","/congress/bills/"+this.billId).text("Explore »"))))}):e!="industries"&&e!="politicians"&&e!="pacs"&&e!="lobbyists"&&e=="organizations");t.paging.next!=undefined&&r.append($("<div>").attr("class","pagination-centered").append($("<ul>").attr("class","pagination").append($("<li>").attr("class","current").append($("<a>").attr("href","#").attr("data-page",t.paging.next-1).text(t.paging.next-1))).append($("<li>").attr("class","arrow").append($("<a>").attr("href","#").attr("data-page",t.paging.next).text("More results »")))));return r}var $content=$(".searchArea");getParam("fields")&&getParam("query")&&runSearch({fields:getSelected().join(),query:$(".searchInput").val()});$(".searchSelector a").on("click",function(e){e.preventDefault();$(this).parent().toggleClass("active");var t=getSelected().join(),n=getParam("fields",e.target.href);history.pushState("","",e.target.href.replace("fields="+n,"fields="+t));$(this).parent().hasClass("active")?runSearch({fields:t,query:$(".searchInput").val(),scroll:$(this).text().toLowerCase()}):runSearch({fields:t,query:$(".searchInput").val()})});$(".searchInput, .menuSearch").on("keyup",function(){$(this).hasClass("searchInput")?$(".menuSearch").val($(this).val()):$(".searchInput").val($(this).val())}).on("keypress",function(e){if(e.which==13){e.preventDefault();var t=getParam("query",location.search).split(" ").join("%20");history.pushState("","",location.search.replace("query="+t,"query="+$(this).val()));runSearch({fields:getSelected().join(),query:$(this).val()})}});$(".menuSearchClick").on("click",function(e){e.preventDefault();runSearch({fields:getSelected().join(),query:$(this).prev().val()})});$(document).on("click",".searchTypeContainer .pagination a",function(e){e.preventDefault();var t=$(this).attr("data-page"),n=$(this).parents(".searchTypeContainer").attr("data-searchtype"),r={};r.fields=getSelected().join();r.query=$(".searchInput").val();r.scroll=n;r[n]=t;runSearch(r)});