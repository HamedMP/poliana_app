(function(){var e,t,n,r,i=$("#graphs"),s={name:"total",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},o=function(){this.init=function(){e=new u;t=new a;n=new f;r=new l;var s=this;$.get("/industries/"+$("#industrySlug").text()+"/"+$("#industryID").text(),{format:"json"},function(e){e.monthly_total.democrat_sum!=0&&e.monthly_total.republican_sum!=0&&e.monthly_total.independent_sum!=0&&e.monthly_total.states!=undefined&&e.monthly_total.top_recipients!=undefined&&e.monthly_total.bottom_recipients!=undefined&&s.run(e);i.append($("<p>").attr("class","hero").html("<b>Sorry, we don't have enough data on this industry yet.</b>"));$("#industrySlug, #industryID").remove()})};this.populateData=function(e,t){var n;if(e=="party"){n=s;n.children[0].size=t.monthly_total.democrat_sum;n.children[1].size=t.monthly_total.republican_sum;n.children[2].size=t.monthly_total.independent_sum}else if(e=="geo"){n=new Array;$.each(t.monthly_total.states,function(e,t){n.push(t)});function r(e,t){return e.sum<t.sum?-1:e.sum>t.sum?1:0}n=n.sort(r).reverse()}else if(e=="most"){n=new Array;$.each(t.monthly_total.top_recipients,function(e,t){n.push(t)});function r(e,t){return e.sum<t.sum?-1:e.sum>t.sum?1:0}n=n.sort(r).reverse()}else if(e=="least"){n=new Array;$.each(t.monthly_total.bottom_recipients,function(e,t){n.push(t)});function r(e,t){return e.sum<t.sum?-1:e.sum>t.sum?1:0}n=n.sort(r).reverse()}return n};this.run=function(i){e.init(this.populateData("party",i));t.init(this.populateData("geo",i));n.init(this.populateData("most",i));r.init(this.populateData("least",i))};this.update=function(i){e.update(this.populateData("party",i));t.update(this.populateData("geo",i));n.update(this.populateData("most",i));r.update(this.populateData("least",i))}},u=function(){var e={};this.init=function(t){i.append($("<div>").attr("class","large-4 small-10 large-uncentered small-centered columns graph").attr("id","partyContributions").append($("<h4>").attr("class",function(){if(t!=undefined)return"h4Pad"}).text("Party Contributions")).append($("<div>").attr("class","sharable").append($("<span>").attr("aria-hidden",!0).attr("class","icon-earth")).append($("<span>").text("Share"))));var n=$("#partyContributions");n.hide();e.width=300;e.height=300;e.radius=Math.min(e.width,e.height)/2;e.color=d3.scale.ordinal().range(["#61D2D6","#EA3556","#888888"]).domain(d3.range(0,3));e.svg=d3.select("#partyContributions").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(e.width,e.height)+" "+Math.min(e.width,e.height)).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate("+e.width/2+","+e.height/2+") rotate(90)");e.partition=d3.layout.partition().sort(null).size([2*Math.PI,e.radius*e.radius]).value(function(e){return e.size});e.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)-20}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)});n.find("h4").after($("<ul>").attr("class","legend top").append($("<li>").append($("<span>").attr("class","square").css("background",e.color(0))).append($("<span>").attr("class","title").text("Democrat"))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(1))).append($("<span>").attr("class","title").text("Republican"))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(2))).append($("<span>").attr("class","title").text("Independent"))));this.update(t)};this.update=function(t){function s(e,t){return e.value<t.value?-1:e.value>t.value?1:0}function p(e){$(".partyCT-center li").removeClass("currentCenter").hide();$(".partyCT-center li:eq("+e+")").addClass("currentCenter").fadeIn(250)}function d(){return parseInt($(".partyCT-center li.currentCenter").index())}function v(){var e=n.find("svg g:first-of-type"),t=e[0].getBoundingClientRect().height,r=e[0].getBoundingClientRect().width,i=n.find(".partyCT-center"),s=i.height(),o=i.width();i.css("margin-top",t/2-s/2-12).css("margin-left",r/2-o/2-3)}function m(){var e=n.find("svg"),t=e.width();e.height(t+20)}var n=$("#partyContributions"),r=e.svg.datum(t).selectAll("path").data(e.partition.nodes).enter().append("path").attr("d",e.arc).style("stroke-width","1px").style("stroke","#fafafa").style("fill",function(t){return t.depth==0?"#fafafa":t.name=="D"?e.color(0):t.name=="R"?e.color(1):e.color(2)}),i=t.children[0].size+t.children[1].size+t.children[2].size,o=t.children.sort(s).reverse(),u=convertParty(o[0].name),a=convertParty(o[1].name),f=convertParty(o[2].name),l=parseInt(o[0].value/i*100),c=parseInt(o[1].value/i*100),h=100-(l+c);n.find(".legend").after($("<ul>").attr("class","partyCT-center interactive").append($("<li>").append($("<span>").attr("class","title").text(u)).append($("<span>").attr("class","amount").text(l+"%"))).append($("<li>").append($("<span>").attr("class","title").text(a)).append($("<span>").attr("class","amount").text(c+"%"))).append($("<li>").append($("<span>").attr("class","title").text(f)).append($("<span>").attr("class","amount").text(h+"%"))));p(0);n.find(".partyCT-center").on("click",function(){var e=d();e+1>=$(this).siblings().length-1?p(0):p(e+1)});n.fadeIn(500);v();m();$(window).on("resize",function(){v();m()})}},a=function(){var e={};this.init=function(t){function s(){var e=convertState("each","name").split(","),t="";$.each(e,function(n,r){t+="<option>"+e[n]+"</option>"});return t}i.append($("<div>").attr("class","large-6 large-offset-2 columns graph hide-for-small").append($("<div>").attr("id","geoCT").append($("<h4>").attr("class",function(){if(t.length!=0)return"h4Pad"}).text("Geographic Contributions")).append($("<div>").attr("class","sharable").append($("<span>").attr("aria-hidden",!0).attr("class","icon-earth")).append($("<span>").text("Share"))))).append($("<div>").attr("class","small-12 columns show-for-small").append($("<h4>").attr("class",function(){if(t.length!=0)return"h4Pad"}).text("Geographic Contributions")).append($("<div>").append($("<table>").attr("class","sortable prettyTable").append($("<thead>").append($("<tr>").append($("<th>").attr("width",140).attr("data-sort","string").text("State")).append($("<th>").attr("data-sort","currency").text("Amount")))).append($("<tbody>")))));for(var n=0;n<t.length;n++)convertState(t[n].state,"name")!=""&&i.find("tbody").append($("<tr>").append($("<td>").text(convertState(t[n].state,"name"))).append($("<td>").text("$"+commaSeparateNumber(t[n].sum))));var r=function(e){return e.replace("$","").replace(/,/g,"")};$("table.sortable").stupidtable({currency:function(e,t){aDate=r(e);bDate=r(t);return aDate-bDate}}).find("th:eq(0)").trigger("click");var o=$("#geoCT");o.hide();e.width=500;e.height=500;e.centered="";e.color=d3.scale.ordinal().range(["#C4D117","#CAD449","#D1D77A","#D7DAAC","#DDDDDD"]).domain(d3.range(0,5));e.svg=d3.select("#geoCT").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(e.width,e.height)+" "+Math.min(e.width,e.height)).attr("preserveAspectRatio","xMinYMin");e.projection=d3.geo.albersUsa().scale(900).translate([e.width/2,e.height/2]);e.path=d3.geo.path().projection(e.projection);e.g=e.svg.append("g").attr("transform","translate(100,0)");o.find("h4").after($("<ul>").attr("class","legend top leftFloat").append($("<li>").append($("<span>").attr("class","title").text("Most")).append($("<span>").attr("class","square").css("background",e.color(0)))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(1)))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(2)))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(3)))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(4))).append($("<span>").attr("class","title").text("Least"))));o.find("svg").before($("<div>").attr("class","d3Tooltip smallCentered"));this.update(t)};this.update=function(t){var n=$("#geoCT");d3.json("/assets/us.json",function(r,i){function s(t){n.find(".d3Tooltip").fadeOut(250);var r,i,s;if(t&&e.centered!==t){var o=e.path.centroid(t);r=o[0]-40;i=o[1];s=3;e.centered=t}else{r=147;i=e.height/2;s=1;e.centered=null}e.g.selectAll("path").classed("active",e.centered&&function(t){return t===e.centered});e.g.transition().duration(500).attr("transform","translate("+e.width/2+","+e.height/2+") scale("+s+") translate("+ -r+","+ -i+")");n.find(".d3Tooltip").fadeIn(250)}function o(e){var r=convertState(e,"name"),i;$.each(t,function(t,n){if(n.state==e){i=n.sum;return}});n.find(".d3Tooltip").html("").append($("<h5>").text(r).append($("<p>").html(function(){return i!=undefined?"Contributions: <i>$"+commaSeparateNumber(i)+"</i>":"Contributions: <i>$0</i>"})))}function u(){var e=n.find("svg"),t=$("#partyContributions").find("svg").width();e.height(t+20)}e.g.append("g").selectAll("path").data(topojson.feature(i,i.objects.states).features).enter().append("path").attr("d",e.path).attr("fill",function(n,r){var i=-1;$.each(t,function(e,t){t.state==n.id&&(i=e)});if(i==-1)return"#888888";if(i>=0)return i>=0&&i<10?e.color(0):i>=10&&i<20?e.color(1):i>=20&&i<30?e.color(2):i>=30&&i<40?e.color(3):e.color(4)}).style("stroke-width","1px").style("stroke","#fafafa").attr("class","interactive").on("mouseover",function(e){o(e.id)}).on("click",s);n.find("path").on("mouseover",function(){n.find(".d3Tooltip").show()}).on("mouseout",function(){n.find(".d3Tooltip").hide()}).on("mousemove",throttle(function(e){var t=e.pageX-n.offset().left,r=e.pageY-n.offset().top;t<n.width()/2?n.find(".d3Tooltip").css("left",t+20).css("top",r+10):n.find(".d3Tooltip").css("left",t+$(".d3Tooltip").width()*-1-10).css("top",r+10)},10));n.fadeIn(500);u();$(window).on("resize",function(){u()})})}},f=function(){var e={};this.init=function(t){i.append($("<div>").attr("class","large-6 small-12 large-uncentered small-centered columns graph").attr("id","mostPaid").append($("<h4>").text("Most Paid Politicians")).append($("<div>").attr("class","sharable").append($("<span>").attr("aria-hidden",!0).attr("class","icon-earth")).append($("<span>").text("Share"))));var n=$("#mostPaid");n.hide();e.width=460;e.height=200;e.x=d3.scale.ordinal().rangeRoundBands([0,e.width],.1);e.y=d3.scale.linear().range([e.height,0]);e.xAxis=d3.svg.axis().scale(e.x).orient("bottom");var r=[],s=6,o=t[0].sum/s;for(var u=0;u<s;u++)r.push(Math.floor(u*o));e.yAxis=d3.svg.axis().scale(e.y).tickValues(r).tickFormat(function(e){return"$"+currencyNumber(e,0)}).orient("left");e.color=d3.scale.ordinal().range(["#A82221","#DB5E31","#EDA23E","#F2CB67","#D6BF59"]).domain(d3.range(0,5));e.svg=d3.select("#mostPaid").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+e.width+" "+e.height).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate(55,0) scale(0.87)");n.find("svg").after($("<ul>").attr("class","legend bottom leftPad"));$.each(t,function(t,r){n.find(".legend").append($("<li>").append($("<span>").attr("class","square").css("background",e.color(t))).append($("<a>").attr("href","/politicians/"+r.first_name.toLowerCase().replace(/\s+/g,"").replace(/"(.*?)"/ig,"")+"-"+r.last_name.toLowerCase().replace(/\s+/g,"").replace(/"(.*?)"/ig,"")+"/"+r.bioguide_id).append($("<span>").attr("class","title").text(r.first_name+" "+r.last_name+" ("+convertParty(r.party,"abbrev")+" - "+r.state+")"))))});this.update(t)};this.update=function(t){function i(){var e=n.find("svg"),t=e.find("g:first-of-type"),r=t[0].getBoundingClientRect().height;e.height(r+20)}var n=$("#mostPaid");t=JSON.parse(JSON.stringify(t));e.x.domain(t.map(function(e){return e.bioguide_id}));e.y.domain([0,d3.max(t,function(e){return e.sum})]);var r=e.svg.append("g").attr("class","y axis").call(e.yAxis);r.selectAll("line").attr("x1",4).attr("x2",e.width-4);r.selectAll("text").attr("font-size","1.25em").attr("x",-4);e.svg.selectAll(".bar").data(t).enter().append("rect").attr("class","bar").attr("x",function(t){return e.x(t.bioguide_id)}).attr("width",e.x.rangeBand()).attr("y",function(t){return e.y(t.sum)}).attr("height",function(t){t.sum<0&&(t.sum=0);return e.height-e.y(t.sum)}).attr("fill",function(t,n){return e.color(n)});n.fadeIn(500);i();$(window).on("resize",function(){i()})}},l=function(){var e={};this.init=function(t){i.append($("<div>").attr("class","large-6 small-12 large-uncentered small-centered columns graph").attr("id","leastPaid").append($("<h4>").text("Least Paid Politicians")).append($("<div>").attr("class","sharable").append($("<span>").attr("aria-hidden",!0).attr("class","icon-earth")).append($("<span>").text("Share"))));var n=$("#leastPaid");n.hide();e.width=460;e.height=200;e.x=d3.scale.ordinal().rangeRoundBands([0,e.width],.1);e.y=d3.scale.linear().range([e.height,0]);e.xAxis=d3.svg.axis().scale(e.x).orient("bottom");var r=[],s=6,o=t[0].sum/s;for(var u=0;u<s;u++)r.push(Math.floor(u*o));e.yAxis=d3.svg.axis().scale(e.y).tickValues(r).tickFormat(function(e){return"$"+currencyNumber(e,0)}).orient("left");e.color=d3.scale.ordinal().range(["#0B486B","#3B8686","#79BD9A","#A8DBA8","#CEF0B7"]).domain(d3.range(0,5));e.svg=d3.select("#leastPaid").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+e.width+" "+e.height).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate(55,0) scale(0.87)");n.find("svg").after($("<ul>").attr("class","legend bottom leftPad"));$.each(t,function(t,r){n.find(".legend").append($("<li>").append($("<span>").attr("class","square").css("background",e.color(t))).append($("<a>").attr("href","/politicians/"+r.first_name.toLowerCase().replace(/\s+/g,"").replace(/"(.*?)"/ig,"")+"-"+r.last_name.toLowerCase().replace(/\s+/g,"").replace(/"(.*?)"/ig,"")+"/"+r.bioguide_id).append($("<span>").attr("class","title").text(r.first_name+" "+r.last_name+" ("+convertParty(r.party,"abbrev")+" - "+r.state+")"))))});this.update(t)};this.update=function(t){function i(){var e=n.find("svg");e.height($("#mostPaid svg").height())}var n=$("#leastPaid");t=JSON.parse(JSON.stringify(t));e.x.domain(t.map(function(e){return e.bioguide_id}));e.y.domain([0,d3.max(t,function(e){return e.sum})]);var r=e.svg.append("g").attr("class","y axis").call(e.yAxis);r.selectAll("line").attr("x1",4).attr("x2",e.width-4);r.selectAll("text").attr("font-size","1.25em").attr("x",-4);e.svg.selectAll(".bar").data(t).enter().append("rect").attr("class","bar").attr("x",function(t){return e.x(t.bioguide_id)}).attr("width",e.x.rangeBand()).attr("y",function(t){return e.y(t.sum)}).attr("height",function(t){t.sum<0&&(t.sum=0);return e.height-e.y(t.sum)}).attr("fill",function(t,n){return e.color(n)});n.fadeIn(500);i();$(window).on("resize",function(){i()})}},c=new o;c.init()})();