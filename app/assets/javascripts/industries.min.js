(function(){var e,t,n,r,i=$("#graphs"),s={name:"total",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},o=function(){this.init=function(){e=new u;t=new a;n=new f;r=new l;var i=this;$.get("/industries/"+$("#industrySlug").text()+"/"+$("#industryID").text(),{format:"json"},function(e){i.run(e);$("#industrySlug, #industryID").remove()})};this.populateData=function(e,t){var n;if(e=="party"){n=s;n.children[0].size=t.monthly_total.democrat_sum;n.children[1].size=t.monthly_total.republican_sum;n.children[2].size=t.monthly_total.independent_sum}else if(e=="geo"){n=new Array;$.each(t.monthly_total.states,function(e,t){n.push(t)})}return n};this.run=function(i){e.init(this.populateData("party",i));t.init(this.populateData("geo",i));n.init(this.populateData("most",i));r.init(this.populateData("least",i))};this.update=function(i){e.update(this.populateData("party",i));t.update(this.populateData("geo",i));n.update(this.populateData("most",i));r.update(this.populateData("least",i))}},u=function(){var e={};this.init=function(t){i.append($("<div>").attr("class","large-4 small-10 large-uncentered small-centered columns graph").attr("id","partyContributions").append($("<h4>").attr("class","h4Pad").text("Party Contributions")).append($("<div>").attr("class","sharable").append($("<span>").attr("aria-hidden",!0).attr("class","icon-earth")).append($("<span>").text("Share"))));var n=$("#partyContributions");n.hide();e.width=300;e.height=300;e.radius=Math.min(e.width,e.height)/2;e.color=d3.scale.ordinal().range(["#61D2D6","#EA3556","#888888"]).domain(d3.range(0,3));e.svg=d3.select("#partyContributions").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(e.width,e.height)+" "+Math.min(e.width,e.height)).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate("+e.width/2+","+e.height/2+") rotate(90)");e.partition=d3.layout.partition().sort(null).size([2*Math.PI,e.radius*e.radius]).value(function(e){return e.size});e.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)-20}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)});n.find("h4").after($("<ul>").attr("class","legend top").append($("<li>").append($("<span>").attr("class","square").css("background",e.color(0))).append($("<span>").attr("class","title").text("Democrat"))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(1))).append($("<span>").attr("class","title").text("Republican"))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(2))).append($("<span>").attr("class","title").text("Independent"))));this.update(t)};this.update=function(t){function s(e,t){return e.value<t.value?-1:e.value>t.value?1:0}function p(e){$(".partyCT-center li").removeClass("currentCenter").hide();$(".partyCT-center li:eq("+e+")").addClass("currentCenter").fadeIn(250)}function d(){return parseInt($(".partyCT-center li.currentCenter").index())}function v(){var e=n.find("svg g:first-of-type"),t=e[0].getBoundingClientRect().height,r=e[0].getBoundingClientRect().width,i=n.find(".partyCT-center"),s=i.height(),o=i.width();i.css("margin-top",t/2-s/2-2).css("margin-left",r/2-o/2-3)}function m(){var e=n.find("svg"),t=e.width();e.height(t+20)}var n=$("#partyContributions"),r=e.svg.datum(t).selectAll("path").data(e.partition.nodes).enter().append("path").attr("d",e.arc).style("stroke-width","1px").style("stroke","#fafafa").style("fill",function(t){return t.depth==0?"#fafafa":t.name=="D"?e.color(0):t.name=="R"?e.color(1):e.color(2)}),i=t.children[0].size+t.children[1].size+t.children[2].size,o=t.children.sort(s).reverse(),u=convertParty(o[0].name),a=convertParty(o[1].name),f=convertParty(o[2].name),l=parseInt(o[0].value/i*100),c=parseInt(o[1].value/i*100),h=parseInt(o[2].value/i*100);n.find(".legend").after($("<ul>").attr("class","partyCT-center interactive").append($("<li>").append($("<span>").attr("class","title").text(u)).append($("<span>").attr("class","amount").text(l+"%"))).append($("<li>").append($("<span>").attr("class","title").text(a)).append($("<span>").attr("class","amount").text(c+"%"))).append($("<li>").append($("<span>").attr("class","title").text(f)).append($("<span>").attr("class","amount").text(h+"%"))));p(0);n.find(".partyCT-center").on("click",function(){var e=d();e+1>=$(this).siblings().length-1?p(0):p(e+1)});n.fadeIn(500);v();m();$(window).on("resize",function(){v();m()})}},a=function(){var e={};this.init=function(t){function n(){var e=convertState("each","name").split(","),t="";$.each(e,function(n,r){t+="<option>"+e[n]+"</option>"});return t}$("#graphs").append($("<div>").attr("class","hide-for-small").append($("<div>").attr("class","large-6 large-offset-2 columns graph").attr("id","geoCT").append($("<h4>").attr("class","h4Pad").text("Geographic Contributions")).append($("<div>").attr("class","sharable").append($("<span>").attr("aria-hidden",!0).attr("class","icon-earth")).append($("<span>").text("Share"))))).append($("<div>").attr("class","show-for-small").append($("<h4>").attr("class","small-12 columns h4Pad").text("Geographic Contributions")).append($("<form>").attr("class","small-12 columns custom").append($("<select>").attr("class","large expand").attr("id","stateSelector").append($("<option>").attr("selected","selected").text("All states")).append(n()))));var r=$("#geoCT");r.hide();e.width=500;e.height=500;e.centered="";e.color=d3.scale.ordinal().range(["#C4D117","#CAD449","#D1D77A","#D7DAAC","#DDDDDD"]).domain(d3.range(0,5));e.svg=d3.select("#geoCT").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(e.width,e.height)+" "+Math.min(e.width,e.height)).attr("preserveAspectRatio","xMinYMin");e.projection=d3.geo.albersUsa().scale(900).translate([e.width/2,e.height/2]);e.path=d3.geo.path().projection(e.projection);e.g=e.svg.append("g").attr("transform","translate(100,0)");r.find("h4").after($("<ul>").attr("class","legend top leftFloat").append($("<li>").append($("<span>").attr("class","title").text("Most")).append($("<span>").attr("class","square").css("background",e.color(0)))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(1)))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(2)))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(3)))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(4))).append($("<span>").attr("class","title").text("Least"))));r.find("svg").before($("<div>").attr("class","d3Tooltip smallCentered"));this.update(t)};this.update=function(t){function r(e,t){return e.sum<t.sum?-1:e.sum>t.sum?1:0}var n=$("#geoCT");t=t.sort(r).reverse();d3.json("/assets/us.json",function(r,i){function s(t){n.find(".d3Tooltip").fadeOut(250);var r,i,s;if(t&&e.centered!==t){var o=e.path.centroid(t);r=o[0]-40;i=o[1];s=3;e.centered=t}else{r=147;i=e.height/2;s=1;e.centered=null}e.g.selectAll("path").classed("active",e.centered&&function(t){return t===e.centered});e.g.transition().duration(500).attr("transform","translate("+e.width/2+","+e.height/2+") scale("+s+") translate("+ -r+","+ -i+")");n.find(".d3Tooltip").fadeIn(250)}function o(e){var r=convertState(e,"name"),i;$.each(t,function(t,n){if(n.state==e){i=n.sum;return}});n.find(".d3Tooltip").html("").append($("<h5>").text(r).append($("<p>").html("Contributions: <i>$"+commaSeparateNumber(i)+"</i>")))}function u(){var e=n.find("svg"),t=$("#partyContributions").find("svg").width();e.height(t+20)}e.g.append("g").selectAll("path").data(topojson.feature(i,i.objects.states).features).enter().append("path").attr("d",e.path).attr("fill",function(n,r){if(t[r]!=undefined){var i=0;$.each(t,function(e,t){t.state==n.id&&(i=e)});return i>=0&&i<10?e.color(0):i>=10&&i<20?e.color(1):i>=20&&i<30?e.color(2):i>=30&&i<40?e.color(3):e.color(4)}return"#888888"}).style("stroke-width","1px").style("stroke","#fafafa").attr("class","interactive").on("mouseover",function(e){o(e.id)}).on("click",s);n.find("path").on("mouseover",function(){n.find(".d3Tooltip").show()}).on("mouseout",function(){n.find(".d3Tooltip").hide()}).on("mousemove",throttle(function(e){var t=e.pageX-n.offset().left,r=e.pageY-n.offset().top;t<n.width()/2?n.find(".d3Tooltip").css("left",t+10).css("top",r+10):n.find(".d3Tooltip").css("left",t+$(".d3Tooltip").width()*-1-30).css("top",r+10)},10));n.fadeIn(500);u();$(window).on("resize",function(){u()})})}},f=function(){this.init=function(e){console.log(e)};this.update=function(e){console.log(e)}},l=function(){this.init=function(e){console.log(e)};this.update=function(e){console.log(e)}},c=new o;c.init()})();