(function(){var e,t,n,r,i=$("#graphs"),s={name:"total",children:[{name:"D",size:0},{name:"R",size:0},{name:"I",size:0}]},o=function(){this.init=function(){e=new u;t=new a;n=new f;r=new l;var i=this;$.get("/industries/"+$("#industrySlug").text()+"/"+$("#industryID").text(),{format:"json"},function(e){i.run(e);$("#industrySlug, #industryID").remove()})};this.populateData=function(e,t){var n;if(e=="party"){console.log(t);n=s;n.children[0].size=t.monthly_total.democrat_sum;n.children[1].size=t.monthly_total.republican_sum;n.children[2].size=t.monthly_total.independent_sum}return n};this.run=function(i){e.init(this.populateData("party",i));t.init(this.populateData("geo",i));n.init(this.populateData("most",i));r.init(this.populateData("least",i))};this.update=function(i){e.update(this.populateData("party",i));t.update(this.populateData("geo",i));n.update(this.populateData("most",i));r.update(this.populateData("least",i))}},u=function(){var e={};this.init=function(t){i.append($("<div>").attr("class","large-4 small-10 large-uncentered small-centered columns graph").attr("id","partyContributions").append($("<h4>").attr("class","h4Pad").text("Party Contributions")).append($("<div>").attr("class","sharable").append($("<span>").attr("aria-hidden",!0).attr("class","icon-earth")).append($("<span>").text("Share"))));var n=$("#partyContributions");n.hide();e.width=300;e.height=300;e.radius=Math.min(e.width,e.height)/2;e.color=d3.scale.ordinal().range(["#61D2D6","#EA3556","#888888"]).domain(d3.range(0,3));e.svg=d3.select("#partyContributions").append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+Math.min(e.width,e.height)+" "+Math.min(e.width,e.height)).attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate("+e.width/2+","+e.height/2+") rotate(90)");e.partition=d3.layout.partition().sort(null).size([2*Math.PI,e.radius*e.radius]).value(function(e){return e.size});e.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)-20}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)});n.find("h4").after($("<ul>").attr("class","legend top").append($("<li>").append($("<span>").attr("class","square").css("background",e.color(0))).append($("<span>").attr("class","title").text("Democrat"))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(1))).append($("<span>").attr("class","title").text("Republican"))).append($("<li>").append($("<span>").attr("class","square").css("background",e.color(2))).append($("<span>").attr("class","title").text("Independent"))));this.update(t)};this.update=function(t){function s(e,t){return e.value<t.value?-1:e.value>t.value?1:0}function p(e){$(".partyCT-center li").removeClass("currentCenter").hide();$(".partyCT-center li:eq("+e+")").addClass("currentCenter").fadeIn(250)}function d(){return parseInt($(".partyCT-center li.currentCenter").index())}function v(){var e=n.find("svg g:first-of-type"),t=e[0].getBoundingClientRect().height,r=e[0].getBoundingClientRect().width,i=n.find(".partyCT-center"),s=i.height(),o=i.width();i.css("margin-top",t/2-s/2-2).css("margin-left",r/2-o/2-3)}function m(){var e=n.find("svg"),t=e.width();e.height(t+20)}var n=$("#partyContributions"),r=e.svg.datum(t).selectAll("path").data(e.partition.nodes).enter().append("path").attr("d",e.arc).style("stroke-width","1px").style("stroke","#fafafa").style("fill",function(t){return t.depth==0?"#fafafa":t.name=="D"?e.color(0):t.name=="R"?e.color(1):e.color(2)}),i=t.children[0].size+t.children[1].size+t.children[2].size,o=t.children.sort(s).reverse(),u=convertParty(o[0].name),a=convertParty(o[1].name),f=convertParty(o[2].name),l=parseInt(o[0].value/i*100),c=parseInt(o[1].value/i*100),h=parseInt(o[2].value/i*100);n.find(".legend").after($("<ul>").attr("class","partyCT-center interactive").append($("<li>").append($("<span>").attr("class","title").text(u)).append($("<span>").attr("class","amount").text(l+"%"))).append($("<li>").append($("<span>").attr("class","title").text(a)).append($("<span>").attr("class","amount").text(c+"%"))).append($("<li>").append($("<span>").attr("class","title").text(f)).append($("<span>").attr("class","amount").text(h+"%"))));p(0);n.find(".partyCT-center").on("click",function(){var e=d();e+1>=$(this).siblings().length-1?p(0):p(e+1)});n.fadeIn(500);v();m();$(window).on("resize",function(){v();m()})}},a=function(){this.init=function(e){console.log(e)};this.update=function(e){console.log(e)}},f=function(){this.init=function(e){console.log(e)};this.update=function(e){console.log(e)}},l=function(){this.init=function(e){console.log(e)};this.update=function(e){console.log(e)}},c=new o;c.init();$("h1").on("click",function(){var e=(new Date).getTime();c.update("You clicked the title of industry "+$("#industryID").html()+" at time of "+e)})})();